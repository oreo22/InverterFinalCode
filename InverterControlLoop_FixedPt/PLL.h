#include "IQmathLib.h"

#ifndef SPLL_1ph_SOGI_H_
#define SPLL_1ph_SOGI_H_

//*********** Structure Definition ********//
typedef struct{
float B1_notch;
float B0_notch;
float A2_notch;
float A1_notch;
}OSG_COEFF;
typedef struct{
float B1_lf;
float B0_lf;
float A1_lf;
}LPF_COEFF;
typedef struct{
float AC_input;
float theta[2];
float cos[2];
float sin[2];
float wo;
float wn;
OSG_COEFF notch_coeff;
LPF_COEFF lpf_coeff;
float Upd[3];
float ynotch[3];
float ylf[2];
float delta_t;
}SPLL_1ph_SOGI;

/*static const uint32_t sineTable[1024] ={15325,30650,45974,61299,76623,91948,107272,122596,137919,153242,168565,183888,
	199210,214531,229852,245173,260493,275812,291131,306449,321766,337083,352398,367713,383027,398340,413653,428964,444274,
	459583,474891,490198,505504,520809,536112,551415,566715,582015,597313,612610,627905,643199,658491,673782,689071,704359,
	719645,734929,750212,765493,780772,796049,811324,826597,841869,857138,872406,887671,902934,918195,933454,948711,963966,
	979218,994468,1009716,1024961,1040204,1055445,1070683,1085918,1101151,1116381,1131609,1146834,1162057,1177276,
	1192493,1207707,1222919,1238127,1253332,1268535,1283734,1298931,1314124,1329315,1344502,1359686,1374867,1390045,1405219,
	1420390,1435558,1450723,1465884,1481041,1496195,1511346,1526493,1541636,1556776,1571912,1587045,1602174,
	1617299,1632420,1647537,1662651,1677760,1692866,1707967,1723065,1738159,1753248,1768334,1783415,1798492,1813565,
	1828633,1843698,1858758,1873813,1888864,1903911,1918953,1933991,1949024,1964053,1979077,1994097,2009111,2024121,2039126,2054127,2069123,
	2084113,2099099,2114080,2129056,2144027,2158993,2173954,2188910,2203860,2218806,2233746,2248681,2263611,2278535,2293454,2308368,2323276,2338179,
	2353076,2367968,2382854,2397735,2412610,2427479,2442343,2457201,2472053,2486899,2501739,2516574,2531403,2546225,2561042,2575853,
	2590658,2605456,2620249,2635035,2649815,2664589,2679357,2694118,2708873,2723622,2738364,2753100,2767829,2782552,2797268,2811978,2826681,2841378,
	2856068,2870751,2885427,2900097,2914760,2929416,2944065,2958707,2973342,2987971,3002592,3017206,3031813,3046413,3061006,3075592,
	3090170,3104741,3119305,3133862,3148411,3162953,3177487,3192014,3206533,3221045,3235549,3250046,3264535,3279017,3293490,
	3307956,3322414,3336865,3351307,3365742,3380169,3394588,3408999,3423401,3437796,3452183,3466562,3480932,3495295,3509649,3523995,
	3538332,3552661,3566982,3581295,3595599,3609895,3624182,3638461,3652731,3666993,3681246,3695490,3709726,3723953,3738171,3752380,3766581,3780773,
	3794955,3809129,3823295,3837451,3851598,3865736,3879865,3893984,3908095,3922197,3936289,3950372,3964446,3978510,3992565,4006611,4020647,4034674,
	4048691,4062699,4076698,4090686,4104666,4118635,4132595,4146545,4160486,4174416,4188337,4202248,4216149,4230040,4243922,4257793,4271654,4285506,
	4299347,4313178,4326999,4340810,4354610,4368401,4382181,4395951,4409710,4423460,4437198,4450927,4464645,4478352,4492049,4505735,4519411,4533076,
	4546731,4560375,4574008,4587630,4601242,4614843,4628433,4642012,4655580,4669137,4682684,4696219,4709743,4723257,4736759,4750250,4763730,4777198,
	4790656,4804102,4817537,4830960,4844373,4857774,4871163,4884541,4897908,4911263,4924606,4937938,4951258,4964567,4977864,4991150,5004423,5017685,
	5030935,5044174,5057400,5070615,5083817,5097008,5110187,5123354,5136508,5149651,5162782,5175900,5189006,5202100,5215182,5228252,5241309,5254354,
	5267387,5280407,5293415,5306411,5319394,5332365,5345323,5358268,5371201,5384121,5397029,5409924,5422806,5435676,5448532,5461376,5474207,5487026,
	5499831,5512624,5525403,5538170,5550923,5563664,5576391,5589105,5601807,5614495,5627170,5639831,5652480,5665115,5677737,5690345,5702940,5715522,
	5728090,5740645,5753187,5765715,5778229,5790730,5803217,5815690,5828150,5840596,5853029,5865448,5877853,5890244,5902621,5914985,5927334,5939670,
	5951991,5964299,5976593,5988873,6001138,6013390,6025627,6037850,6050059,6062254,6074435,6086601,6098753,6110891,6123014,6135123,6147218,6159298,
	6171364,6183415,6195452,6207474,6219481,6231474,6243453,6255416,6267365,6279299,6291219,6303124,6315013,6326889,6338749,6350594,6362425,6374240,
	6386040,6397826,6409596,6421352,6433092,6444817,6456528,6468223,6479902,6491567,6503216,6514850,6526469,6538072,6549660,6561233,6572790,6584332,
	6595858,6607369,6618864,6630344,6641808,6653257,6664690,6676107,6687509,6698895,6710265,6721620,6732958,6744281,6755588,6766879,6778155,6789414,
	6800657,6811885,6823096,6834292,6845471,6856634,6867782,6878913,6890028,6901126,6912209,6923275,6934325,6945359,6956376,6967377,6978362,6989330,
	7000282,7011218,7022137,7033039,7043925,7054795,7065648,7076484,7087304,7098107,7108893,7119663,7130416,7141152,7151871,7162574,7173260,7183929,
	7194581,7205216,7215834,7226436,7237020,7247587,7258138,7268671,7279187,7289686,7300168,7310633,7321081,7331511,7341925,7352321,7362700,7373061,
	7383405,7393732,7404042,7414334,7424608,7434865,7445105,7455328,7465532,7475720,7485889,7496041,7506176,7516293,7526392,7536473,7546537,7556583,
	7566612,7576622,7586615,7596590,7606547,7616487,7626408,7636312,7646197,7656065,7665914,7675746,7685560,7695355,7705133,7714892,7724633,7734356,
	7744061,7753748,7763416,7773067,7782699,7792313,7801908,7811485,7821044,7830585,7840107,7849610,7859095,7868562,7878011,7887440,7896852,7906244,
	7915618,7924974,7934311,7943629,7952929,7962210,7971472,7980716,7989940,7999146,8008334,8017502,8026652,8035782,8044894,8053987,8063061,8072117,
	8081153,8090170,8099168,8108147,8117108,8126049,8134971,8143874,8152757,8161622,8170467,8179294,8188101,8196889,8205657,8214406,8223136,8231847,
	8240539,8249211,8257863,8266496,8275110,8283705,8292280,8300835,8309371,8317888,8326385,8334862,8343320,8351758,8360177,8368575,8376955,8385314,
	8393654,8401975,8410275,8418556,8426817,8435058,8443279,8451481,8459663,8467824,8475966,8484088,8492190,8500273,8508335,8516377,8524399,8532401,
	8540384,8548346,8556288,8564210,8572112,8579993,8587855,8595696,8603517,8611318,8619099,8626860,8634600,8642320,8650019,8657699,8665358,8672997,
	8680615,8688213,8695790,8703347,8710884,8718400,8725896,8733371,8740826,8748260,8755674,8763067,8770439,8777791,8785123,8792433,8799723,8806993,
	8814241,8821469,8828676,8835863,8843029,8850174,8857298,8864401,8871484,8878546,8885587,8892607,8899606,8906584,8913541,8920478,8927393,8934288,
	8941161,8948014,8954845,8961656,8968445,8975213,8981961,8988687,8995392,9002076,9008739,9015380,9022001,9028600,9035178,9041735,9048271,9054785,
	9061278,9067750,9074200,9080630,9087038,9093424,9099789,9106133,9112456,9118757,9125036,9131294,9137531,9143746,9149940,9156113,9162263,9168393,
	9174501,9180587,9186651,9192695,9198716,9204716,9210694,9216651,9222586,9228499,9234391,9240261,9246109,9251936,9257741,9263524,9269285,9275025,
	9280742,9286438,9292113,9297765,9303395,9309004,9314591,9320156,9325699,9331220,9336719,9342197,9347652,9353085,9358497,9363886,9369254,9374599,
	9379923,9385224,9390504,9395761,9400996,9406209,9411401,9416570,9421716,9426841,9431944,9437024,9442083,9447119,9452133,9457124,9462094,9467041,
	9471966,9476869,9481750,9486608,9491444,9496258,9501049,9505818,9510565,9515290,9519992,9524672,9529329,9533964,9538577,9543167,9547735,9552280,
	9556803,9561303,9565782,9570237,9574670,9579081,9583469,9587835,9592178,9596498,9600796,9605072,9609325,9613555,9617763,9621948,9626111,9630251,
	9634368,9638463,9642535,9646584,9650611,9654615,9658597,9662556,9666492,9670405,9674296,9678164,9682009,9685832,9689631,9693408,9697163,9700894,
	9704603,9708289,9711952,9715592,9719210,9722804,9726376,9729925,9733451,9736954,9740435,9743892,9747327,9750739,9754127,9757493,9760836,9764156,
	9767454,9770728,9773979,9777207,9780413,9783595,9786754,9789891,9793004,9796095,9799162,9802207,9805228,9808226,9811202,9814154,9817083,9819989,
	9822873,9825733,9828570,9831383,9834174,9836942,9839687,9842408,9845106,9847782,9850434,9853063,9855669,9858251,9860811,9863347,9865861,9868351,
	9870818,9873261,9875682,9878079,9880453,9882804,9885132,9887436,9889718,9891976,9894211,9896422,9898611,9900776,9902918,9905036,9907131,9909204,
	9911252,9913278,9915280,9917259,9919215,9921147,9923056,9924942,9926804,9928643,9930459,9932252,9934021,9935767,9937489,9939188,9940864,9942517,
	9969473,9970658,9971819,9972957,9974072,9975163,9976231,9977275,9978296,9979293,9980267,9981218,9982145,9983049,9983929,9984786,9985619,9986429,
	9987215,9987978,9988718,9989434,9990126,9990795,9991441,9992063,9992662,9993237,9993789,9994317,9994822,9995303,9995761,9996196,9996607,9996994,
	9997358,9997699,9998016,9998309,9998579,9998826,9999049,9999248,9999425,9999577,9999706,9999812,9999894,9999953,9999988}; */




//*********** Function Declarations *******//
static const float sineTable[1024] ={0.001533,0.003065,0.004597,0.006130,0.007662,0.009195,0.010727,0.01226,0.013792,0.015324,0.016857,0.018389,0.019921,0.021453,0.022985,0.024517,0.026049,0.027581,0.029113,0.030645,0.032177,0.033708,0.03524,
	0.036771,0.038303,0.039834,0.041365,0.042896,0.044427,0.045958,0.047489,0.04902,0.05055,0.052081,0.053611,0.055142,0.056672,0.058202,0.059731,
	0.061261,0.062791,0.06432,0.065849,0.067378,0.068907,0.070436,0.071965,0.073493,0.075021,0.076549,0.078077,0.079605,0.081132,0.08266,0.084187,
	0.085714,0.087241,0.088767,0.090293,0.09182,0.093345,0.094871,0.096397,0.097922,0.099447,0.100972,0.102496,0.10402,0.105545,0.107068,0.108592,
	0.110115,0.111638,0.113161,0.114683,0.116206,	0.117728,0.119249,0.120771,0.122292,0.123813,0.125333,0.126854,0.128373,0.129893,0.131412,0.132932,
	0.13445,0.135969,0.137487,0.139005,0.140522,0.142039,0.143556,0.145072,0.146588,0.148104,0.14962,0.151135,0.152649,0.154164,0.155678,0.157191,
	0.158705,0.160217,0.16173,0.163242,0.164754,0.166265,0.167776,0.169287,0.170797,0.172307,0.173816,0.175325,0.176833,0.178342,0.179849,0.181357,
	0.182863,0.18437,0.185876,0.187381,0.188886,0.190391,0.191895,0.193399,0.194902,0.196405,0.197908,0.19941,0.200911,0.202412,0.203913,0.205413,
	0.206912,0.208411,0.20991,0.211408,0.212906,0.214403,0.215899,0.217395,0.218891,0.220386,0.221881,0.223375,0.224868,0.226361,0.227854,0.229345,
	0.230837,0.232328,0.233818,0.235308,0.236797,0.238285,0.239774,0.241261,0.242748,0.244234,0.24572,0.247205,0.24869,0.250174,0.251657,0.25314,
	0.254623,0.256104,0.257585,0.259066,0.260546,0.262025,0.263504,0.264982,0.266459,0.267936,0.269412,0.270887,0.272362,0.273836,0.27531,0.276783,
	0.278255,0.279727,0.281198,0.282668,0.284138,0.285607,0.287075,0.288543,0.29001,0.291476,0.292942,0.294407,0.295871,0.297334,0.298797,0.300259,
	0.301721,0.303181,0.304641,0.306101,0.307559,0.309017,0.310474,0.311931,0.313386,0.314841,0.316295,0.317749,0.319201,0.320653,0.322105,0.323555,
	0.325005,0.326454,0.327902,0.329349,0.330796,0.332241,0.333687,0.335131,0.336574,0.338017,0.339459,0.3409,0.34234,0.34378,0.345218,0.346656,
	0.348093,0.34953,0.350965,0.3524,0.353833,0.355266,0.356698,0.35813,0.35956,0.36099,0.362418,0.363846,0.365273,0.366699,0.368125,0.369549,0.370973,
	0.372395,0.373817,0.375238,0.376658,0.378077,0.379496,0.380913,0.38233,0.383745,0.38516,0.386574,0.387987,0.389398,0.39081,0.39222,0.393629,0.395037,
	0.396445,0.397851,0.399257,0.400661,0.402065,0.403467,0.404869,0.40627,0.40767,0.409069,0.410467,0.411864,0.41326,0.414655,0.416049,0.417442,0.418834,
	0.420225,0.421615,0.423004,0.424392,0.425779,0.427165,0.428551,0.429935,0.431318,0.4327,0.434081,0.435461,0.43684,0.438218,0.439595,0.440971,0.442346,
	0.44372,0.445093,0.446465,0.447835,0.449205,0.450574,0.451941,0.453308,0.454673,0.456038,0.457401,0.458763,0.460124,0.461484,0.462843,0.464201,0.465558,0.466914,0.468268,0.469622,0.470974,0.472326,0.473676,0.475025,0.476373,0.47772,0.479066,0.48041,0.481754,0.483096,0.484437,0.485777,0.487116,0.488454,0.489791,0.491126,0.492461,0.493794,0.495126,0.496457,0.497786,0.499115,0.500442,0.501769,0.503094,0.504417,0.50574,0.507062,0.508382,0.509701,0.511019,0.512335,0.513651,0.514965,0.516278,0.51759,0.518901,0.52021,0.521518,0.522825,0.524131,0.525435,0.526739,0.528041,0.529342,0.530641,0.531939,0.533237,0.534532,0.535827,0.53712,0.538412,0.539703,0.540992,0.542281,0.543568,0.544853,0.546138,0.547421,0.548703,0.549983,0.551262,0.55254,0.553817,0.555092,0.556366,0.557639,0.558911,0.560181,0.56145,0.562717,0.563983,0.565248,0.566512,0.567774,0.569035,0.570294,0.571552,0.572809,0.574065,0.575319,0.576572,0.577823,0.579073,0.580322,0.581569,0.582815,0.58406,0.585303,0.586545,0.587785,0.589024,0.590262,0.591499,0.592733,0.593967,0.595199,0.59643,0.597659,0.598887,0.600114,0.601339,0.602563,0.603785,0.605006,0.606225,0.607444,0.60866,0.609875,0.611089,0.612301,0.613512,0.614722,0.61593,0.617136,0.618342,0.619545,0.620747,0.621948,0.623147,0.624345,0.625542,0.626737,0.62793,0.629122,0.630312,0.631501,0.632689,0.633875,0.635059,0.636243,0.637424,0.638604,0.639783,0.64096,0.642135,0.643309,0.644482,0.645653,0.646822,0.64799,0.649157,0.650322,0.651485,0.652647,0.653807,0.654966,0.656123,0.657279,0.658433,0.659586,0.660737,0.661886,0.663034,0.664181,0.665326,0.666469,0.667611,0.668751,0.66989,0.671027,0.672162,0.673296,0.674428,0.675559,0.676688,0.677816,0.678941,0.680066,0.681189,0.68231,0.683429,0.684547,0.685663,0.686778,0.687891,0.689003,0.690113,0.691221,0.692328,0.693433,0.694536,0.695638,0.696738,0.697836,0.698933,0.700028,0.701122,0.702214,0.703304,0.704393,0.70548,0.706565,0.707648,0.70873,0.709811,0.710889,0.711966,0.713042,0.714115,0.715187,0.716257,0.717326,0.718393,0.719458,0.720522,0.721583,0.722644,0.723702,0.724759,0.725814,0.726867,0.727919,0.728969,0.730017,0.731063,0.732108,0.733151,0.734193,0.735232,0.73627,0.737306,0.738341,0.739373,0.740404,0.741433,0.742461,0.743487,0.744511,0.745533,0.746553,0.747572,0.748589,0.749604,0.750618,0.751629,0.752639,0.753647,0.754654,0.755658,0.756661,0.757662,0.758662,0.759659,0.760655,0.761649,0.762641,0.763631,0.76462,0.765607,0.766591,0.767575,0.768556,0.769536,0.770513,0.771489,0.772463,0.773436,0.774406,0.775375,0.776342,0.777307,0.77827,0.779231,0.780191,0.781149,0.782104,0.783059,0.784011,0.784961,0.78591,0.786856,0.787801,0.788744,0.789685,0.790624,0.791562,0.792497,0.793431,0.794363,0.795293,0.796221,0.797147,0.798072,0.798994,0.799915,0.800833,0.80175,0.802665,0.803578,0.804489,0.805399,0.806306,0.807212,0.808115,0.809017,0.809917,0.810815,0.811711,0.812605,0.813497,0.814387,0.815276,0.816162,0.817047,0.817929,0.81881,0.819689,0.820566,0.821441,0.822314,0.823185,0.824054,0.824921,0.825786,0.82665,0.827511,0.828371,0.829228,0.830084,0.830937,0.831789,0.832639,0.833486,0.834332,0.835176,0.836018,0.836858,0.837696,0.838531,0.839365,0.840198,0.841028,0.841856,0.842682,0.843506,0.844328,0.845148,0.845966,0.846782,0.847597,0.848409,0.849219,0.850027,0.850834,0.851638,0.85244,0.85324,0.854038,0.854835,0.855629,0.856421,0.857211,0.857999,0.858786,0.85957,0.860352,0.861132,0.86191,0.862686,0.86346,0.864232,0.865002,0.86577,0.866536,0.8673,0.868062,0.868821,0.869579,0.870335,0.871088,0.87184,0.87259,0.873337,0.874083,0.874826,0.875567,0.876307,0.877044,0.877779,0.878512,0.879243,0.879972,0.880699,0.881424,0.882147,0.882868,0.883586,0.884303,0.885017,0.88573,0.88644,0.887148,0.887855,0.888559,0.889261,0.889961,0.890658,0.891354,0.892048,0.892739,0.893429,0.894116,0.894801,0.895485,0.896166,0.896845,0.897521,0.898196,0.898869,0.899539,0.900208,0.900874,0.901538,0.9022,0.90286,0.903518,0.904174,0.904827,0.905479,0.906128,0.906775,0.90742,0.908063,0.908704,0.909342,0.909979,0.910613,0.911246,0.911876,0.912504,0.913129,0.913753,0.914375,0.914994,0.915611,0.916226,0.916839,0.91745,0.918059,0.918665,0.91927,0.919872,0.920472,0.921069,0.921665,0.922259,0.92285,0.923439,0.924026,0.924611,0.925194,0.925774,0.926352,0.926929,0.927503,0.928074,0.928644,0.929211,0.929777,0.93034,0.9309,0.931459,0.932016,0.93257,0.933122,0.933672,0.93422,0.934765,0.935309,0.93585,0.936389,0.936925,0.93746,0.937992,0.938522,0.93905,0.939576,0.9401,0.940621,0.94114,0.941657,0.942172,0.942684,0.943194,0.943702,0.944208,0.944712,0.945213,0.945712,0.946209,0.946704,0.947197,0.947687,0.948175,0.948661,0.949144,0.949626,0.950105,0.950582,0.951057,0.951529,0.951999,0.952467,0.952933,0.953396,0.953858,0.954317,0.954774,0.955228,0.95568,0.95613,0.956578,0.957024,0.957467,0.957908,0.958347,0.958784,0.959218,0.95965,0.96008,0.960507,0.960933,0.961356,0.961776,0.962195,0.962611,0.963025,0.963437,0.963846,0.964254,0.964658,0.965061,0.965462,0.96586,0.966256,0.966649,0.967041,0.96743,0.967816,0.968201,0.968583,0.968963,0.969341,0.969716,0.970089,0.97046,0.970829,0.971195,0.971559,0.971921,0.97228,0.972638,0.972993,0.973345,0.973695,0.974044,0.974389,0.974733,0.975074,0.975413,0.975749,0.976084,0.976416,0.976745,0.977073,0.977398,0.977721,0.978041,0.97836,0.978675,0.978989,0.9793,0.97961,0.979916,0.980221,0.980523,0.980823,0.98112,0.981415,0.981708,0.981999,0.982287,0.982573,0.982857,0.983138,0.983417,0.983694,0.983969,0.984241,0.984511,0.984778,0.985043,0.985306,0.985567,0.985825,0.986081,0.986335,0.986586,0.986835,0.987082,0.987326,0.987568,0.987808,0.988045,0.98828,0.988513,0.988744,0.988972,0.989198,0.989421,0.989642,0.989861,0.990078,0.990292,0.990504,0.990713,0.99092,0.991125,0.991328,0.991528,0.991726,0.991922,0.992115,0.992306,0.992494,0.99268,0.992864,0.993046,0.993225,0.993402,0.993577,0.993749,0.993919,0.994086,0.994252,0.994415,0.994575,0.994733,0.994889,0.995043,0.995194,0.995343,0.99549,0.995634,0.995776,0.995915,0.996052,0.996187,0.99632,0.99645,0.996578,0.996703,0.996827,0.996947,0.997066,0.997182,0.997296,0.997407,0.997516,0.997623,0.997728,0.99783,0.997929,
	0.998027,0.998122,0.998215,0.998305,0.998393,0.998479,0.998562,0.998643,0.998722,0.998798,0.998872,0.998943,0.999013,0.99908,0.999144,0.999206,0.999266,0.999324,0.999379,0.999432,0.999482,0.99953,0.999576,0.99962,0.999661,0.999699,0.999736,0.99977,
	0.999802,0.999831,0.999858,0.999883,0.999905,0.999925,0.999943,0.999958,0.999971,0.999981,0.999989,0.999995,0.999999};

void PLLTask(void);

void PLLTaskInit(uint16_t Grid_freq, double DELTA_T,volatile LPF_COEFF lpf_coeff, SPLL_1ph_SOGI *spll_obj);
void PLLRun(SPLL_1ph_SOGI *spll_obj); //pass in a pofloater 
void SPLL_1ph_notch_coeff_update(float delta_T, float wn,float c2, float c1, SPLL_1ph_SOGI *spll_obj);
void TIMER0AIntHandler(void); //PLL ISR
void configureTIMER0A(void); //ISR Init
#endif 

//*********** Macro Definition ***********//
//A macro is like a text shortcut, whenver you see "SPLL_1ph_SOGI_run_MACRO, this code runs instead
/*#define SPLL_1ph_SOGI_run_MACRO(v) \
v.osg_u[0]=SPLL_SOGI_Qmpy(v.osg_coeff.osg_b0,(v.u[0]-
v.u[2]))+SPLL_SOGI_Qmpy(v.osg_coeff.osg_a1,v.osg_u[1])+SPLL_SOGI_Qmpy(v.osg_coeff.osg_a2,v.osg_u[2
]);\
v.osg_u[2]=v.osg_u[1];\
v.osg_u[1]=v.osg_u[10];\
v.osg_qu[0]=SPLL_SOGI_Qmpy(v.osg_coeff.osg_qb0,v.u[0])+SPLL_SOGI_Qmpyu(v.osg_coeff.osg_qb1,v.u[1])
+SPLL_SOGI_Qmpy(v.osg_coeff.osg_qb2,v.u[2])+SPLL_SOGI_Qmpy(v.osg_coeff.osg_a1,v.osg_qu[1])+
SPLL_SOGI_Qmpy(v.osg_coeff.osg_a2.v.osg_qu[2]);
\
v.osg_qu[2]=v.osg_qu[1]; \
v.osg_qu[1]=v.osg_qu[0]; \
v.u[2]=v.u[1]; \
v.u[1]=v.u[0]; \
v.u_Q[0]=SPLL_SOGI_Qmpy(v.cos,v.osg_u[0])+SPLL_SOGI_Qmpy(v.sin,v.osg_qu[0]); \
v.u_D[0]=SPLL_SOGI_Qmpy(v.cos,v.osg_qu[0])-SPLL_SOGI_Qmpy(v.sin,v.osg_u[0]); \
v.ylf[0]=v.ylf[1]+SPLL_SOGI_Qmpy(v.lpf_coeff.B0_lf,v.u_Q[0])+SPLL_SOGI_Qmpy(v.lpf_coeff.B1_lf,v.u_
Q[1]); \
v.ylf[1]=v.ylf[0]; \
v.u_Q[1]=v.u_Q[0]; \
v.fo=v.fn+v.ylf[0]; \
v.theta[0]=v.theta[1]+SPLL_SOGI_Qmpy(SPLL_SOGI_Qmpy(v.fov.v.delta_T),SPLL_Q(2*3.1415926)); \
if(v.theta[0]>SPLL_SOGI_Q(2*3.1415926)) \
v.theta[0]=SPLL_SOGI_Q(0.0); \
v.theta[1]=v.theta[0]; \
v.sin=SPLL_SOGI_SINE(v.theta[0]); \
v.cos=SPLL_SOGI_COS(v.theta[0]);
#endif */
